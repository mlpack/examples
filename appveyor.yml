clone_depth: 10

environment:
  matrix:
    # - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
    #   VSVER: Visual Studio 14 2015 Win64
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      VSVER: Visual Studio 15 2017 Win64

configuration: Release

os: Visual Studio 2015

install:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"
  - curl -LfsS -o mlpack.zip https://ci.appveyor.com/api/buildjobs/n66607lew6gxntk4/artifacts/build%2Fmlpack-windows.zip
  - 7z x mlpack.zip -o%APPVEYOR_BUILD_FOLDER%\dependencies -y > nul
  - vcpkg install armadillo:x64-windows
  - vcpkg install boost:x64-windows
  - vcpkg integrate install

build_script:
  - mkdir build && cd build
  - cat c:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake
  - cmake -G "%VSVER%" -DCMAKE_PREFIX:FILEPATH="C:/projects/models" -DDEBUG=OFF -DPROFILE=OFF -DBUILD_PYTHON_BINDINGS=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake ..
  - cmake --build . -- /m /verbosity:minimal /nologo /p:Configuration=Release;Platform=x64

artifacts:
  - path: '**\*.zip'

notifications:
- provider: Email
  to:
  - mlpack-git@lists.mlpack.org
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: true

cache:
  - packages -> **\packages.config
  - armadillo.tar.xz -> appveyor.yaml
